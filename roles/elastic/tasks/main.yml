- name: Install python-software-properties
  apt: pkg=python-software-properties state=present update_cache=yes cache_valid_time={{apt_cache_valid_time}}

- name: Add java repo
  apt_repository: repo={{ apt_java_repo }} state=present update_cache=yes
  when: install_java

- name: Accept Oracle license prior JDK installation
  debconf: name='oracle-java7-installer' question='shared/accepted-oracle-license-v1-1' value='true' vtype='select'
  when: install_java

- name: Install Java
  apt: pkg={{apt_java_package}} state=present
  when: install_java

- name: Import Elastic GPG Key
  apt_key: url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch state=present

- name: Add Elastic Repo into source list
  apt_repository: repo='deb http://packages.elasticsearch.org/elasticsearch/{{ elasticsearch_repo_version }}/debian stable main' state=present

- name: Install dependencies
  apt: pkg={{ item }} state=present update_cache=yes
  with_items: apt_dependencies

- name: Install Elasticsearch
  apt: pkg={{ elasticsearch_pkg }} state=present

- name: Configuring Elasticsearch
  template: src=elasticsearch.yml.j2 dest=/etc/elasticsearch/elasticsearch.yml owner=root group=root mode=0644
  notify: restart elasticsearch
