input {
  lumberjack {
    port => 5043
    ssl_certificate => "{{ ssl_cert_directory }}/{{ ssl_cert }}"
    ssl_key => "{{ ssl_cert_directory }}/{{ ssl_key }}"
  }
}
filter {
  if [type] == "cluster-error" {
    multiline {
      pattern => "^\s"
      what => "previous"
    }
  } else {
    mutate {
      gsub => ["message", "\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]", ""]
    }
    grok {
      match => { "message" => "%{WORD:method} %{URIPATHPARAM:request} %{NUMBER:status} %{NUMBER:time} ms - (?<bytes>[0-9]*|-)" }
    }
    grok {
      match => { "request" => "/%{WORD:end_point}" }
    }
    mutate {
      convert => { "status" => "integer" }
      convert => { "bytes" => "integer" }
      convert => { "time" => "float" }
    }
  }
}
output {
  elasticsearch { }
}
